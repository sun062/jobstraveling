<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>잡스트레블링 - 비밀번호 찾기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; }
        .input-field { width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; transition: border-color 0.15s ease-in-out; font-size: 16px; }
        .input-field:focus { outline: none; border-color: #3b82f6; }
        .input-label { display: block; font-weight: 500; color: #4b5563; margin-bottom: 4px; font-size: 14px; }
        .search-button { padding: 12px 0; font-size: 18px; font-weight: 700; color: white; background-color: #10b981; border-radius: 8px; transition: background-color 0.15s; box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.2), 0 2px 4px -2px rgba(16, 185, 129, 0.2); }
        .search-button:hover { background-color: #059669; }
    </style>
</head>
<body class="p-4 sm:p-8 flex items-center justify-center min-h-screen">
    <div class="max-w-md w-full mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl space-y-8">
        <header class="text-center pb-4">
            <h1 class="text-3xl font-bold text-gray-800">비밀번호 찾기</h1>
            <p class="text-sm text-gray-500 mt-2">회원 정보 확인을 위해 다음 정보를 입력해 주세요.</p>
        </header>

        <form id="forgotPasswordForm" onsubmit="handleFindPassword(event)" class="space-y-6">
            <section class="space-y-4 border p-4 rounded-lg bg-gray-50/50">
                <h2 class="text-lg font-semibold text-gray-700">나의 학교 정보</h2>
                <div>
                    <label for="school" class="input-label">학교 *</label>
                    <input type="text" id="school" name="school" placeholder="등록된 학교명을 입력하세요" class="input-field" required>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <div><label for="classNum" class="input-label">반 *</label><input type="number" id="classNum" name="classNum" placeholder="반" class="input-field" required></div>
                    <div><label for="studentNum" class="input-label">번호 *</label><input type="number" id="studentNum" name="studentNum" placeholder="번호" class="input-field" required></div>
                    <div><label class="input-label opacity-0">임시</label><div class="h-[44px]"></div></div>
                </div>
            </section>
            
            <section class="space-y-4">
                <h2 class="text-lg font-semibold text-gray-700">개인 정보</h2>
                <div><label for="name" class="input-label">이름 *</label><input type="text" id="name" name="name" placeholder="이름을 입력하세요" class="input-field" required></div>
                <div><label for="userId" class="input-label">아이디 *</label><input type="text" id="userId" name="userId" placeholder="아이디" class="input-field" required></div>
            </section>
            
            <button type="submit" class="w-full search-button mt-4">비밀번호 찾기</button>
        </form>

        <div class="text-center text-sm text-gray-500 pt-4 space-x-2">
            <a href="#" onclick="requestStreamlitRedirect('login')" class="hover:underline">로그인</a>
            <span>/</span>
            <a href="#" onclick="showMessage('아이디 찾기 화면으로 이동합니다. (구현 예정)')" class="hover:underline">아이디 찾기</a>
            <span>/</span>
            <a href="#" onclick="requestStreamlitRedirect('signup')" class="hover:underline">회원가입</a>
        </div>

        <!-- 메시지 박스 -->
        <div id="messageBox" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white p-6 rounded-xl shadow-xl max-w-sm w-full text-center">
                <p id="messageText" class="text-gray-800 font-medium mb-4"></p>
                <div id="actionButtons" class="space-x-2">
                    <button onclick="continueAction()" id="messageBoxConfirmButton" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">확인</button>
                    <button onclick="requestStreamlitRedirect('login')" id="loginRedirectButton" class="hidden px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">로그인 화면으로 넘어가시겠습니까?</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase 초기화 및 인증 로직을 위한 공통 JS 코드를 HTML <script> 부분에 추가합니다.
        // 이 코드는 모든 HTML 파일에 복사되어야 합니다.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, setDoc, doc, query, where, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        let db;
        let auth;
        let userId; 
        let appId;
        let isFirebaseReady = false; 
        
        async function initializeFirebase() {
            try {
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('Debug');
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser?.uid || crypto.randomUUID();
                isFirebaseReady = true; 
                console.log("Firebase initialized successfully. User ID:", userId);
                
                if (typeof onPageLoad === 'function') {
                    onPageLoad(); 
                }

            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error);
            }
        }
        
        function getUsersCollectionRef() {
            if (!isFirebaseReady) {
                console.error("Database not initialized.");
                return null;
            }
            // 공용 데이터 경로: /artifacts/{appId}/public/data/users
            const path = `artifacts/${appId}/public/data/users`; 
            return collection(db, path);
        }
        
        function showMessage(text, action = null) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            
            messageText.textContent = text;
            window.nextAction = action; 
            if (messageBox) messageBox.classList.remove('hidden');
        }

        function hideMessage() {
            const messageBox = document.getElementById('messageBox');
            if (messageBox) messageBox.classList.add('hidden');
        }
        
        function continueAction() {
            hideMessage();
            if (typeof window.nextAction === 'function') {
                window.nextAction(); 
                window.nextAction = null; 
            }
        }

        function requestStreamlitRedirect(pageName) {
            parent.postMessage({type: 'NAVIGATE', page: pageName}, '*');
        }

        window.onload = initializeFirebase;
        
        // --- 비밀번호 찾기 화면 전용 JS ---

        async function handleFindPassword(event) {
            event.preventDefault(); 
            
            if (!isFirebaseReady) {
                showMessage('데이터베이스 연결 중입니다. 잠시 후 다시 시도해 주세요.');
                return;
            }
            
            showMessage('비밀번호 찾기 기능 구현 예정입니다. 다음 단계에서 Firestore에서 회원 정보를 조회하는 로직을 추가합니다.');
        }
    </script>
</body>
</html>
